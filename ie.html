<!DOCTYPE html>
<html>
<body>

<canvas id="myCanvas" width="300" height="300" style="border:1px solid #d3d3d3;">
Your browser does not support the HTML5 canvas tag.</canvas>

<img id="overview" width="200" height="200"
src="cssmap.png" alt="overview">

<script>

var img = document.getElementById("overview");
img.crossOrigin = "anonymous";
var xdir = 0;
var ydir = 0;
var xv =0;
var yv =0;
var x = 0;
var y = 0;

var vx =0;
var vy =0;
document.addEventListener('keydown', function(event) {
    if (event.keyCode == 37) {
       xdir = -1;

    }
    else if (event.keyCode == 39) {
       xdir = 1;
    }

    if (event.keyCode == 38) {
       ydir = -1;

    }
    else if (event.keyCode == 40) {
       ydir = 1;
    }
}, true);

document.addEventListener('keyup', function(event) {
    if (event.keyCode == 37) {
       xdir = 0;

    }
    else if (event.keyCode == 39) {
       xdir = 0;
    }

    if (event.keyCode == 38) {
       ydir = 0;

    }
    else if (event.keyCode == 40) {
       ydir = 0;
    }
}, true);


var c = document.getElementById("myCanvas");
var ctx = c.getContext("2d");
setInterval(draw, 15);


function draw() {
ctx.fillStyle = "blue";
ctx.fillRect(0, 0, 300, 300);

ctx.drawImage(img, -x-50, -y-25);



xv+=xdir;
yv+=ydir;

x += xv;
y += yv;

vx = x/25+125;
vy = y/25+125;

xv = xv*0.5;
yv = yv*0.5;

var imgData = ctx.getImageData(vx-1, vy-1, 27, 27);
for (var i = 0, n = imgData.data.length; i < n; i += 4) {
red = imgData.data[i];
green = imgData.data[i+1];
blue = imgData.data[i+2];
alpha = imgData.data[i+3];
if (red == 0 && green == 0 && blue >0 ){
xv=-xdir*5;
yv=-ydir*5;

}}



ctx.fillStyle = "red";

ctx.fillRect(vx, vy, 25, 25);

//ctx.fillStyle = "green";

//ctx.fillRect(0, 0, 50, 50);
//ctx.drawImage(img, 0, 0,50,50);

//ctx.fillStyle = "red";

//ctx.fillRect((x-50)/20, (y-25)/20, 5, 5);
//ctx = c.getContext("2d");
}
</script>

</body>
</html>
